<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ate≈ü ve Su: Nihai Strateji Sava≈üƒ±</title>
    <style>
        * { touch-action: none; -webkit-user-select: none; box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #05050a; position: fixed; width: 100%; height: 100%; font-family: sans-serif; }
        canvas { display: block; }

        /* Aray√ºz Paneli */
        #ui {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: flex; flex-direction: column; align-items: center;
            color: white; font-size: 16px; font-weight: bold; pointer-events: none;
            z-index: 50; text-shadow: 2px 2px 5px #000; opacity: 0.8;
        }
        .timer-box { background: rgba(255,255,255,0.15); padding: 5px 15px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.3); margin: 10px 0; }

        /* Buton Kontrolleri */
        .controls { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        .btn-group { display: flex; gap: 8px; pointer-events: auto; position: absolute; }
        .p1-controls { top: 25px; left: 25px; } /* Ate≈ü: Sol √úst */
        .p2-controls { bottom: 25px; right: 25px; } /* Su: Saƒü Alt */

        .btn {
            width: 60px; height: 60px; background: rgba(255, 255, 255, 0.2);
            border: 3px solid rgba(255, 255, 255, 0.5); border-radius: 12px;
            display: flex; justify-content: center; align-items: center; color: white; font-size: 24px;
        }
        .red-btn { border-color: #ff4d4d; color: #ff4d4d; }
        .blue-btn { border-color: #4da6ff; color: #4da6ff; }
        .btn:active { transform: scale(0.85); background: rgba(255, 255, 255, 0.4); }
    </style>
</head>
<body>

<div id="ui">
    <div style="color: #ff4d4d;">üî• Ate≈ü: <span id="fScore">0</span></div>
    <div class="timer-box">‚è≥ <span id="timer">60</span></div>
    <div style="color: #4da6ff;">‚ùÑÔ∏è Su: <span id="wScore">0</span></div>
</div>

<canvas id="gameCanvas"></canvas>

<div class="controls">
    <div class="btn-group p1-controls">
        <div id="fL" class="btn red-btn">‚Üê</div>
        <div id="fU" class="btn red-btn">‚Üë</div>
        <div id="fR" class="btn red-btn">‚Üí</div>
        <div id="fS" class="btn red-btn">üî•</div>
    </div>
    <div class="btn-group p2-controls">
        <div id="wS" class="btn blue-btn">‚ùÑÔ∏è</div>
        <div id="wL" class="btn blue-btn">‚Üê</div>
        <div id="wU" class="btn blue-btn">‚Üë</div>
        <div id="wR" class="btn blue-btn">‚Üí</div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let platforms = [], hazards = [], powerUps = [], bullets = [];
    let timeLeft = 60;

    function initLevel() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const w = canvas.width;
        const h = canvas.height;

        // Mega Parkur Katlarƒ±
        platforms = [
            { x: 0, y: h - 90, w: w, h: 20 }, 
            { x: 40, y: h - 180, w: 140, h: 12 },
            { x: w - 180, y: h - 180, w: 140, h: 12 },
            { x: w/2 - 100, y: h - 260, w: 200, h: 12 },
            { x: 60, y: h - 340, w: 120, h: 12 },
            { x: w - 180, y: h - 340, w: 120, h: 12 },
            { x: w/2 - 40, y: h - 430, w: 80, h: 15 } // Kupa platformu
        ];

        // G√∂letlerin Farklƒ± Konumlara Daƒüƒ±tƒ±lmasƒ±
        hazards = [
            { x: w * 0.1, y: h - 95, w: 70, h: 10, type: 'fire' },   // Sol Zemin (Lav)
            { x: w * 0.85, y: h - 95, w: 70, h: 10, type: 'fire' },  // Saƒü Zemin (Lav)
            { x: w * 0.45, y: h - 95, w: 70, h: 10, type: 'water' }, // Orta Zemin (Buz)
            { x: w/2 - 35, y: h - 265, w: 70, h: 8, type: 'water' }  // Orta Platform (Buz)
        ];

        powerUps = [
            { x: 50, y: h - 370, w: 30, h: 30, type: 'fire', collected: false },
            { x: w - 80, y: h - 370, w: 30, h: 30, type: 'water', collected: false }
        ];
    }

    const goal = { x: 0, y: 0, w: 40, h: 40, emoji: "üèÜ" };

    class Player {
        constructor(x, y, type, emoji) {
            this.startX = x; this.startY = y;
            this.x = x; this.y = y; this.w = 32; this.h = 32;
            this.type = type; this.emoji = emoji;
            this.vx = 0; this.vy = 0; this.score = 0;
            this.grounded = false; this.jumpCount = 0;
            this.dir = (type === 'fire') ? 1 : -1;
            this.megaTimer = 0;
        }
        draw() {
            ctx.font = this.megaTimer > 0 ? "45px Arial" : "32px Arial";
            if(this.megaTimer > 0) { ctx.shadowBlur = 20; ctx.shadowColor = "white"; }
            ctx.fillText(this.emoji, this.x, this.y + 25);
            ctx.shadowBlur = 0;
        }
        update() {
            this.vy += 0.55; this.x += this.vx; this.y += this.vy;
            if(this.vx !== 0) this.dir = this.vx > 0 ? 1 : -1;
            if(this.megaTimer > 0) this.megaTimer--;

            platforms.forEach(p => {
                if (this.x < p.x + p.w && this.x + this.w > p.x && this.y < p.y + p.h && this.y + this.h > p.y) {
                    if (this.vy > 0 && this.y + this.h - this.vy <= p.y) {
                        this.y = p.y - this.h; this.vy = 0;
                        this.grounded = true; this.jumpCount = 0;
                    }
                }
            });

            hazards.forEach(z => {
                if (this.x < z.x + z.w && this.x + this.w > z.x && this.y < z.y + z.h && this.y + this.h > z.y) {
                    if ((this.type === 'fire' && z.type === 'water') || (this.type === 'water' && z.type === 'fire')) this.die();
                }
            });

            powerUps.forEach(p => {
                if (!p.collected && this.x < p.x + p.w && this.x + this.w > p.x && this.y < p.y + p.h && this.y + this.h > p.y) {
                    if (p.type === this.type) { p.collected = true; this.megaTimer = 600; }
                }
            });

            if (this.x < 0) this.x = 0; if (this.x + this.w > canvas.width) this.x = canvas.width - this.w;
            if (this.y > canvas.height) this.die();

            if(this.x < goal.x + goal.w && this.x + this.w > goal.x && this.y < goal.y + goal.h && this.y + this.h > goal.y) {
                alert(this.type === 'fire' ? "üî• ATE≈û KAZANDI!" : "‚ùÑÔ∏è SU KAZANDI!");
                location.reload();
            }
        }
        jump() { if (this.jumpCount < 2) { this.vy = -12; this.jumpCount++; this.grounded = false; } }
        die() { this.score -= 10; this.reset(); }
        reset() { this.x = this.startX; this.y = this.startY; this.vy = 0; this.vx = 0; this.megaTimer = 0; this.jumpCount = 0; }
    }

    const fire = new Player(30, 100, 'fire', "üî¥");
    const water = new Player(window.innerWidth - 60, 100, 'water', "üîµ");

    function checkCollision() {
        if (fire.x < water.x + water.w && fire.x + fire.w > water.x && fire.y < water.y + water.h && fire.y + fire.h > water.y) {
            if (fire.megaTimer > 0 && water.megaTimer === 0) { water.die(); fire.score += 5; }
            else if (water.megaTimer > 0 && fire.megaTimer === 0) { fire.die(); water.score += 5; }
            else { fire.die(); water.die(); }
        }
    }

    function bind(id, p, action) {
        const el = document.getElementById(id);
        const start = (e) => {
            e.preventDefault();
            if(action === 'L') p.vx = -5.5; else if(action === 'R') p.vx = 5.5;
            else if(action === 'U') p.jump();
            else if(action === 'S') bullets.push({ 
                x: p.x, y: p.y, vx: p.dir * (p.megaTimer > 0 ? 16 : 8), 
                size: p.megaTimer > 0 ? 48 : 24, emoji: p.type === 'fire' ? "üî•" : "‚ùÑÔ∏è", shooter: p 
            });
        };
        el.addEventListener('touchstart', start);
        el.addEventListener('touchend', (e) => { e.preventDefault(); if(action !== 'U') p.vx = 0; });
        el.addEventListener('mousedown', start);
        el.addEventListener('mouseup', () => { if(action !== 'U') p.vx = 0; });
    }

    bind('fL', fire, 'L'); bind('fR', fire, 'R'); bind('fU', fire, 'U'); bind('fS', fire, 'S');
    bind('wL', water, 'L'); bind('wR', water, 'R'); bind('wU', water, 'U'); bind('wS', water, 'S');

    setInterval(() => { if(timeLeft > 0) timeLeft--; else { alert("S√úRE Bƒ∞TTƒ∞!"); location.reload(); }}, 1000);

    function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        document.getElementById('fScore').innerText = fire.score;
        document.getElementById('wScore').innerText = water.score;
        document.getElementById('timer').innerText = timeLeft;

        goal.x = canvas.width/2 - 20; goal.y = canvas.height - 465;
        ctx.font = "40px Arial"; ctx.fillText(goal.emoji, goal.x, goal.y + 35);

        hazards.forEach(z => { ctx.fillStyle = z.type === 'fire' ? '#ff4500' : '#00bfff'; ctx.fillRect(z.x, z.y, z.w, z.h); });
        ctx.fillStyle = "#333"; platforms.forEach(p => { ctx.fillRect(p.x, p.y, p.w, p.h); ctx.strokeStyle="#555"; ctx.strokeRect(p.x, p.y, p.w, p.h); });

        powerUps.forEach(p => { if(!p.collected) { ctx.fillStyle = p.type === 'fire' ? '#ff3333' : '#3399ff'; ctx.font = "bold 20px Arial"; ctx.fillText("M", p.x, p.y + 20); } });

        bullets.forEach((b, i) => {
            b.x += b.vx; ctx.font = b.size + "px Arial"; ctx.fillText(b.emoji, b.x, b.y + 20);
            let enemy = b.shooter === fire ? water : fire;
            if(b.x > enemy.x && b.x < enemy.x + enemy.w && b.y > enemy.y && b.y < enemy.y + enemy.h) {
                enemy.die(); b.shooter.score += 5; bullets.splice(i, 1);
            }
            if(b.x < 0 || b.x > canvas.width) bullets.splice(i, 1);
        });

        checkCollision();
        fire.update(); fire.draw(); water.update(); water.draw();
        requestAnimationFrame(loop);
    }
    window.addEventListener('resize', initLevel); initLevel(); loop();
</script>
</body>
</html>